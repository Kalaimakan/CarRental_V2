@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@model List<CarRental.DTOs.CustomerDto>

<div class="container-fluid py-4">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
        <!-- Header -->
        <div class="card-header text-white py-4 bg-gradient">
            <h2 class="mb-0 fw-bold text-uppercase text-center">
                <i class="bi bi-people-fill me-2"></i> Customer List
            </h2>
        </div>

        <!-- Body -->
        <div class="card-body bg-navy text-white">

            <!-- Search -->
            <div class="d-flex justify-content-end mb-3 gap-2 flex-wrap">
                <input type="text" id="searchInput" placeholder="🔍 Search customers..."
                       class="form-control search-box" style="max-width: 300px;">
                <button id="resetBtn" class="btn btn-secondary" style="display:none;">
                    <i class="bi bi-arrow-counterclockwise"></i> Back
                </button>
            </div>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-dark table-hover align-middle mb-0 rounded-3 overflow-hidden">
                    <thead class="bg-secondary text-light">
                        <tr>
                            <th><i class="bi bi-person-fill me-1"></i>Name</th>
                            <th><i class="bi bi-envelope-fill me-1"></i>Email</th>
                            <th><i class="bi bi-telephone-fill me-1"></i>Phone</th>
                            <th><i class="bi bi-card-text me-1"></i>Licence No</th>
                            <th><i class="bi bi-house-fill me-1"></i>Address</th>
                            <th class="text-center"><i class="bi bi-gear-fill me-1"></i>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var customer in Model)
                            {
                                <tr>
                                    <td class="fw-semibold">@customer.Name</td>
                                    <td>@customer.Email</td>
                                    <td>@customer.PhoneNumber</td>
                                    <td>@customer.LicenceNumber</td>
                                    <td>@customer.Address</td>
                                    <td class="text-center">
                                        <a class="btn btn-sm btn-info me-2 px-3"
                                           asp-controller="Customer" asp-action="CustomerDetail" asp-route-id="@customer.Id">
                                            <i class="bi bi-eye-fill"></i> Detail
                                        </a>
                                        <a class="btn btn-sm btn-warning me-2 px-3"
                                           asp-controller="Customer" asp-action="Update" asp-route-id="@customer.Id">
                                            <i class="bi bi-pencil-fill"></i> Edit
                                        </a>
                                        <a class="btn btn-sm btn-danger px-3"
                                           asp-controller="Customer" asp-action="Delete" asp-route-id="@customer.Id"
                                           onclick="return confirm('Are you sure you want to delete this customer?');">
                                            <i class="bi bi-trash-fill"></i> Delete
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6" class="text-center text-warning">No customers found.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        let searchTimeout;

        document.getElementById('searchInput').addEventListener('input', function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(searchCustomers, 300);
        });

        document.getElementById('resetBtn').addEventListener('click', function () {
            document.getElementById('searchInput').value = "";
            loadAllCustomers();
            this.style.display = "none";
        });

        async function searchCustomers() {
            const query = document.getElementById('searchInput').value.trim();
            if (query === "") { document.getElementById('resetBtn').style.display = "none"; loadAllCustomers(); return; }

            try {
                const response = await fetch(`/Customer/SearchCustomers?query=${encodeURIComponent(query)}`);
                const data = await response.json();
                const tbody = document.querySelector("table tbody");
                tbody.innerHTML = '';

                if (!data || data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="6" class="text-center text-danger">No results found</td></tr>`;
                    return;
                }

                document.getElementById('resetBtn').style.display = "inline-block";

                data.forEach(c => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                                <td class="fw-semibold">${c.name}</td>
                                <td>${c.email}</td>
                                <td>${c.phoneNumber}</td>
                                <td>${c.licenceNumber}</td>
                                <td>${c.address}</td>
                                <td class="text-center">
                                    <a class="btn btn-sm btn-info me-2 px-3" href="/Customer/CustomerDetail/${c.id}">
                                        <i class="bi bi-eye-fill"></i> Detail
                                    </a>
                                    <a class="btn btn-sm btn-warning me-2 px-3" href="/Customer/Update/${c.id}">
                                        <i class="bi bi-pencil-fill"></i> Edit
                                    </a>
                                    <a class="btn btn-sm btn-danger px-3" href="/Customer/Delete/${c.id}" onclick="return confirm('Are you sure you want to delete this customer?');">
                                        <i class="bi bi-trash-fill"></i> Delete
                                    </a>
                                </td>`;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error(error);
            }
        }

        async function loadAllCustomers() {
            try {
                const response = await fetch(`/Customer/SearchCustomers?query=`);
                const data = await response.json();
                const tbody = document.querySelector("table tbody");
                tbody.innerHTML = '';

                if (!data || data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="6" class="text-center text-danger">No customers found</td></tr>`;
                    return;
                }

                data.forEach(c => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                                <td class="fw-semibold">${c.name}</td>
                                <td>${c.email}</td>
                                <td>${c.phoneNumber}</td>
                                <td>${c.licenceNumber}</td>
                                <td>${c.address}</td>
                                <td class="text-center">
                                    <a class="btn btn-sm btn-info me-2 px-3" href="/Customer/CustomerDetail/${c.id}">
                                        <i class="bi bi-eye-fill"></i> Detail
                                    </a>
                                    <a class="btn btn-sm btn-warning me-2 px-3" href="/Customer/Update/${c.id}">
                                        <i class="bi bi-pencil-fill"></i> Edit
                                    </a>
                                    <a class="btn btn-sm btn-danger px-3" href="/Customer/Delete/${c.id}" onclick="return confirm('Are you sure you want to delete this customer?');">
                                        <i class="bi bi-trash-fill"></i> Delete
                                    </a>
                                </td>`;
                    tbody.appendChild(tr);
                });
            } catch (error) { console.error(error); }
        }

        loadAllCustomers();
    </script>
}

<style>
    .bg-gradient {
        background: linear-gradient(135deg, #0d1b2a, #1b263b);
    }

    .bg-navy {
        background-color: #0d1b2a;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(255,255,255,0.05);
        transition: background 0.3s ease;
    }

    .btn-sm {
        border-radius: 8px;
    }

    .btn-info {
        background: linear-gradient(135deg, #00c6ff, #0072ff);
        border: none;
    }

    .btn-warning {
        background: linear-gradient(135deg, #f7971e, #ffd200);
        border: none;
        color: #000;
    }

    .btn-danger {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        border: none;
    }

    .search-box {
        background-color: rgba(255,255,255,0.05);
        color: #e0e6ed;
        border: 1px solid rgba(0,123,255,0.4);
    }

        .search-box:focus {
            background-color: rgba(0,0,0,0.7);
            border-color: #007bff;
            color: #fff;
            box-shadow: 0 0 8px rgba(0,123,255,0.7);
        }
</style>
