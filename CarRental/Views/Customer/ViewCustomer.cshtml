@* @model List<CarRental.DTOs.CustomerDto>

<div class="container mt-5 text-white">
    <h2 class="mb-4 text-uppercase fw-bold border-bottom pb-2">Customer List</h2>

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table class="table table-dark table-striped table-hover align-middle">
                <thead class="table-light text-dark">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Licence No</th>
                        <th>Address</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var customer in Model)
                    {
                        <tr>
                            <td>@customer.Name</td>
                            <td>@customer.Email</td>
                            <td>@customer.PhoneNumber</td>
                            <td>@customer.LicenceNumber</td>
                            <td>@customer.Address</td>
                            <td class="text-center">
                                <a class="btn btn-sm btn-warning me-2" asp-controller="Customer" asp-action="Update" asp-route-id="@customer.Id"
                                   title="Edit Customer">
                                    <i class="bi bi-pencil-fill"></i> Edit
                                </a>
                                <a class="btn btn-sm btn-danger"
                                   asp-controller="Customer" asp-action="Delete" asp-route-id="@customer.Id"
                                   title="Delete Customer"
                                   onclick="return confirm('Are you sure you want to delete this customer?');">
                                    <i class="bi bi-trash-fill"></i> Delete
                                </a>
                                <a class="btn btn-sm btn-info me-2"
                                   asp-controller="Customer" asp-action="CustomerDetail" asp-route-id="@customer.Id"
                                   title="View Customer Details">
                                    <i class="bi bi-eye-fill"></i> Details
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center mt-4" role="alert" style="background-color:#333;">
            <i class="bi bi-exclamation-circle me-2"></i> No customers found.
        </div>
    }
</div>
 *@

 @* Type 01 SuccessMessage ============*@

 @if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
} 


@model List<CarRental.DTOs.CustomerDto>

<div class="container mt-5">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden">

        <!-- Header -->
        <div class="card-header text-white py-4"
             style="background: linear-gradient(135deg, #6a11cb, #2575fc);">
            <h2 class="mb-0 fw-bold text-uppercase text-center">
                <i class="bi bi-people-fill me-2"></i> Customer List
            </h2>
        </div>

        <!-- Body -->

        <div class="card-body bg-dark text-white">

            @if (Model != null && Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle mb-0 rounded-3 overflow-hidden">
                        <thead class="bg-secondary text-light">
                            <tr>
                                <th><i class="bi bi-person-fill me-1"></i>Name</th>
                                <th><i class="bi bi-envelope-fill me-1"></i>Email</th>
                                <th><i class="bi bi-telephone-fill me-1"></i>Phone</th>
                                <th><i class="bi bi-card-text me-1"></i>Licence No</th>
                                <th><i class="bi bi-house-fill me-1"></i>Address</th>
                                <th class="text-center"><i class="bi bi-gear-fill me-1"></i>Actions</th>
                            </tr>

                        </thead>
                        <tbody>

                           
                            @foreach (var customer in Model)
                            {
                                <tr>
                                    <td class="fw-semibold">@customer.Name</td>
                                    <td>@customer.Email</td>
                                    <td>@customer.PhoneNumber</td>
                                    <td>@customer.LicenceNumber</td>
                                    <td>@customer.Address</td>
                                    <td class="text-center">


                                        <a class="btn btn-sm btn-info me-2 px-3"
                                           asp-controller="Customer" asp-action="CustomerDetail" asp-route-id="@customer.Id"
                                           title="View Customer Details">
                                            <i class="bi bi-eye-fill"></i> Detail
                                        </a>
                                        <a class="btn btn-sm btn-warning me-2 px-3"
                                           asp-controller="Customer" asp-action="Update" asp-route-id="@customer.Id"
                                           title="Edit Customer">
                                            <i class="bi bi-pencil-fill"></i> Edit
                                        </a>
                                        <a class="btn btn-sm btn-danger px-3"
                                           asp-controller="Customer" asp-action="Delete" asp-route-id="@customer.Id"
                                           title="Delete Customer"
                                           onclick="return confirm('Are you sure you want to delete this customer?');">
                                            <i class="bi bi-trash-fill"></i> Delete
                                        </a>

                                    </td>
                                </tr>
                            }
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 15px; gap:10px;">
                                <input type="text" id="searchInput" placeholder="🔍 Search customers..."
                                       style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 8px; outline: none; width: 250px;">
                                <button id="resetBtn" class="btn btn-secondary" style="display:none;">
                                    <i class="bi bi-arrow-counterclockwise"></i> Back
                                </button>
                            </div>

                            <ul id="customerResults"></ul>

                            <script>
                                let searchTimeout;

                                document.getElementById('searchInput').addEventListener('input', function () {
                                    clearTimeout(searchTimeout);
                                    searchTimeout = setTimeout(searchCustomers, 300);
                                });

                                document.getElementById('resetBtn').addEventListener('click', function () {
                                    document.getElementById('searchInput').value = "";
                                    loadAllCustomers(); 
                                    this.style.display = "none";
                                });

                                async function searchCustomers() {
                                    const query = document.getElementById('searchInput').value.trim();

                                    if (query === "") {
                                        document.getElementById('resetBtn').style.display = "none";
                                        loadAllCustomers();
                                        return;
                                    }

                                    try {
                                        const response = await fetch(`/Customer/SearchCustomers?query=${encodeURIComponent(query)}`);
                                        if (!response.ok) throw new Error("Search request failed");

                                        const data = await response.json();
                                        const tbody = document.querySelector("table tbody");
                                        tbody.innerHTML = '';

                                        if (!data || data.length === 0) {
                                            tbody.innerHTML = `<tr><td colspan="6" class="text-center text-danger">No results found</td></tr>`;
                                            return;
                                        }

                                        // show reset button since we are in filtered mode
                                        document.getElementById('resetBtn').style.display = "inline-block";

                                        data.forEach(c => {
                                            const tr = document.createElement('tr');
                                            tr.innerHTML = `
                                                    <td class="fw-semibold">${c.name}</td>
                                                    <td>${c.email}</td>
                                                    <td>${c.phoneNumber}</td>
                                                    <td>${c.licenceNumber}</td>
                                                    <td>${c.address}</td>
                                                    <td class="text-center">
                                                        <a class="btn btn-sm btn-info me-2 px-3" href="/Customer/CustomerDetail/${c.id}">
                                                            <i class="bi bi-eye-fill"></i> Detail
                                                        </a>
                                                        <a class="btn btn-sm btn-warning me-2 px-3" href="/Customer/Update/${c.id}">
                                                            <i class="bi bi-pencil-fill"></i> Edit
                                                        </a>
                                                        <a class="btn btn-sm btn-danger px-3" href="/Customer/Delete/${c.id}"
                                                           onclick="return confirm('Are you sure you want to delete this customer?');">
                                                            <i class="bi bi-trash-fill"></i> Delete
                                                        </a>
                                                    </td>
                                                `;
                                            tbody.appendChild(tr);
                                        });

                                    } catch (error) {
                                        console.error("Error:", error);
                                        document.querySelector("table tbody").innerHTML =
                                            `<tr><td colspan="6" class="text-center text-danger">Error fetching results</td></tr>`;
                                    }
                                }

                                // function to reload all customers without filter
                                async function loadAllCustomers() {
                                    try {
                                        const response = await fetch(`/Customer/SearchCustomers?query=`);
                                        if (!response.ok) throw new Error("Load request failed");

                                        const data = await response.json();
                                        const tbody = document.querySelector("table tbody");
                                        tbody.innerHTML = '';

                                        if (!data || data.length === 0) {
                                            tbody.innerHTML = `<tr><td colspan="6" class="text-center text-danger">No customers found</td></tr>`;
                                            return;
                                        }

                                        data.forEach(c => {
                                            const tr = document.createElement('tr');
                                            tr.innerHTML = `
                                                    <td class="fw-semibold">${c.name}</td>
                                                    <td>${c.email}</td>
                                                    <td>${c.phoneNumber}</td>
                                                    <td>${c.licenceNumber}</td>
                                                    <td>${c.address}</td>
                                                    <td class="text-center">
                                                        <a class="btn btn-sm btn-info me-2 px-3" href="/Customer/CustomerDetail/${c.id}">
                                                            <i class="bi bi-eye-fill"></i> Detail
                                                        </a>
                                                        <a class="btn btn-sm btn-warning me-2 px-3" href="/Customer/Update/${c.id}">
                                                            <i class="bi bi-pencil-fill"></i> Edit
                                                        </a>
                                                        <a class="btn btn-sm btn-danger px-3" href="/Customer/Delete/${c.id}"
                                                           onclick="return confirm('Are you sure you want to delete this customer?');">
                                                            <i class="bi bi-trash-fill"></i> Delete
                                                        </a>
                                                    </td>
                                                `;
                                            tbody.appendChild(tr);
                                        });

                                    } catch (error) {
                                        console.error("Error:", error);
                                    }
                                }

                                // load full list initially
                                loadAllCustomers();
                            </script>


                        </tbody>

                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info text-center mt-4 border-0 rounded-3"
                     style="background-color: #2c2c3a; color: #ddd;">
                    <i class="bi bi-exclamation-circle me-2"></i> No customers found.
                </div>
            }


        </div>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
        transition: background 0.3s ease;
    }

    .btn-sm {
        border-radius: 8px;
    }

    .btn-info {
        background: linear-gradient(135deg, #00c6ff, #0072ff);
        border: none;
    }

    .btn-warning {
        background: linear-gradient(135deg, #f7971e, #ffd200);
        border: none;
        color: #000;
    }

    .btn-danger {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        border: none;
    }
</style>


